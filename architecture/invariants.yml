# Invariants Configuration
# These constraints are enforced via ESLint, TypeScript, and CI checks
# See PLAN.md Research F1 for enforcement mapping

version: 1

# Security invariants - enforced via ESLint + custom CI
security:
  - id: no_pii_unencrypted
    description: PII must be encrypted at rest
    enforcement: ci_test
    
  - id: all_endpoints_authenticated
    description: All endpoints require auth except health/metrics
    exceptions:
      - "/health"
      - "/metrics"
      - "/api/v1/public/*"
    enforcement: ci_test
    
  - id: secrets_never_logged
    description: Secrets and tokens must never appear in logs
    enforcement: eslint_no_console_in_prod

# Code quality invariants - enforced via ESLint
code_quality:
  - id: no_explicit_any
    description: No 'any' type allowed
    enforcement: "@typescript-eslint/no-explicit-any"
    
  - id: no_eval
    description: No eval() calls
    enforcement: "no-eval"
    
  - id: no_inner_html
    description: No innerHTML assignments
    enforcement: "no-unsanitized/property"
    
  - id: no_circular_deps
    description: No circular dependencies
    enforcement: "import/no-cycle"

# Performance invariants - enforced via CI benchmarks
performance:
  p95_latency_ms: 200
  p99_latency_ms: 500
  max_memory_mb: 512
  max_bundle_size_kb: 1024
  max_test_duration_s: 60

# Data invariants - enforced via CI tests
data:
  schema_backward_compat_versions: 3
  require_idempotent_writes: true
  require_migration_rollback: true

# Architecture invariants - enforced via ESLint import rules
architecture:
  max_import_depth: 5
  forbidden_patterns:
    - pattern: "any"
      reason: "Defeats type safety"
    - pattern: "eval("
      reason: "Security vulnerability"
    - pattern: ".innerHTML"
      reason: "XSS vulnerability"
    - pattern: "console.log"
      context: "src/**"
      reason: "Use structured logger"

# Success metrics - tracked in drift/metrics.md
success_metrics:
  test_pass_rate_minimum: 99.5
  code_coverage_minimum: 80
  max_cyclomatic_complexity: 10
  max_file_lines: 500

# ESLint rule mapping (for reference)
# These map invariants to actual ESLint configuration
eslint_mapping:
  "@typescript-eslint/no-explicit-any": "error"
  "@typescript-eslint/ban-types": "error"
  "no-eval": "error"
  "import/no-cycle": "error"
  "no-console":
    - "error"
    - allow: ["warn", "error"]
